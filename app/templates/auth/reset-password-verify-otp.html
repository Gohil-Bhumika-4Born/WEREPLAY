<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Verify OTP to reset your WeReplay Admin Panel password.">
    <meta name="keywords" content="WeReplay, Admin Panel, Reset Password, OTP Verification">
    <meta name="author" content="WeReplay">
    <meta name="theme-color" content="#18CB96">

    <title>WeReplay Admin Panel - Reset Password OTP</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='Images/WeReplay-favicon.svg') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='Images/WeReplay-favicon.svg') }}">

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- CSS Files - Minimal CSS for floating labels only (load after Tailwind) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <!-- JavaScript Files -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</head>
<body class="bg-light font-sans antialiased h-screen overflow-hidden">
    <!-- Page Wrapper - Centered Modal-style Card (no page scroll) -->
    <div class="h-full flex items-center justify-center px-4">
        <div class="w-full max-w-6xl max-h-[95vh] bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col lg:flex-row border border-gray/20">
            <!-- Left Column - Illustration (reuse style) -->
            <div class="hidden lg:flex lg:w-3/6 bg-light items-center justify-center p-8 relative overflow-hidden">
                <div class="absolute right-0 top-0 bottom-0 w-10 bg-gradient-to-l from-light via-light to-transparent pointer-events-none"></div>
                <div class="text-center z-10 max-w-lg">
                    <!-- Logo Icon -->
                    <div class="mb-6 ">
                        <img src="{{ url_for('static', filename='Images/We-Replay-Logo.svg') }}" alt="WeReplay Icon" class="h-10 w-auto mx-auto opacity-90" width="31" height="25">
                    </div>

                    <!-- Message -->
                    <h2 class="text-2xl font-bold text-dark mb-3">Check your email</h2>
                    <p class="text-gray text-base mb-8">We have sent a 6-digit OTP to your email address. Enter the code below to continue resetting your password.</p>

                    <!-- Illustration Image (Reset OTP Verify) -->
                    <div class="relative animate-slide-up flex items-center justify-center">
                        <img 
                            src="{{ url_for('static', filename='Images/Reset-Otp-Verify.png') }}" 
                            alt="OTP Verification illustration" 
                            class="max-w-full h-auto object-contain animate-float"
                            loading="lazy"
                        >
                    </div>
                </div>

                <!-- Decorative Elements -->
                <div class="absolute top-0 right-0 w-64 h-64 bg-primary opacity-5 rounded-full blur-3xl"></div>
                <div class="absolute bottom-0 left-0 w-64 h-64 bg-primary opacity-5 rounded-full blur-3xl"></div>
            </div>

            <!-- Right Column - OTP Verification Form -->
            <div class="w-full lg:w-3/5 flex flex-col bg-white relative">
                <!-- Top-corner back icon to reset request -->
                <a href="{{ url_for('auth.reset_password') }}" class="hidden lg:inline-flex items-center justify-center w-9 h-9 rounded-full border border-gray/30 text-gray hover:text-primaryDark hover:border-primaryDark transition-colors absolute top-6 left-6" aria-label="Back to Reset Request">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7 7-7" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h16" />
                    </svg>
                </a>

                <div class="flex-1 flex flex-col justify-center px-6 sm:px-8 lg:px-10 xl:px-12 py-8">
                    <!-- Page Title -->
                    <div class="mb-8 text-center">
                        <h1 class="text-2xl font-bold text-dark mb-3">Verify OTP</h1>
                        <p class="text-sm text-gray">Enter the 6-digit code we&apos;ve sent to your email address</p>
                    </div>

                    <!-- OTP Verification Form -->
                    <form id="resetOtpForm" class="space-y-5 w-full max-w-2xl mx-auto">
                        <!-- Email Text (no input) -->
                        <div class="mb-0 text-center">
                            <p class="text-xs text-gray mb-1">OTP has been sent to this email</p>
                            <p class="inline-flex items-center gap-2 text-sm font-semibold text-dark">
                                <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                </svg>
                                <span id="resetOtpEmailText" class="text-primaryDark break-all"></span>
                            </p>
                        </div>

                        <!-- OTP Inputs -->
                        <div class="mb-0">
                            <label class="block text-sm text-gray-500 mb-3 text-center">Enter OTP Code</label>
                            <div class="flex justify-center gap-3" id="resetOtpContainer">
                                <input type="text" maxlength="1" class="w-12 h-12 text-center text-2xl font-bold border border-gray rounded-lg text-gray focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300" autocomplete="off">
                                <input type="text" maxlength="1" class="w-12 h-12 text-center text-2xl font-bold border border-gray rounded-lg text-gray focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300" autocomplete="off">
                                <input type="text" maxlength="1" class="w-12 h-12 text-center text-2xl font-bold border border-gray rounded-lg text-gray focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300" autocomplete="off">
                                <input type="text" maxlength="1" class="w-12 h-12 text-center text-2xl font-bold border border-gray rounded-lg text-gray focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300" autocomplete="off">
                                <input type="text" maxlength="1" class="w-12 h-12 text-center text-2xl font-bold border border-gray rounded-lg text-gray focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300" autocomplete="off">
                                <input type="text" maxlength="1" class="w-12 h-12 text-center text-2xl font-bold border border-gray rounded-lg text-gray focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300" autocomplete="off">
                            </div>
                            <input type="hidden" id="resetOtpValue" name="otp" value="">
                        </div>

                        <!-- Feedback Message -->
                        <div id="resetOtpMessage" class="hidden text-center text-sm py-2 rounded-lg"></div>

                        <!-- Verify OTP Button -->
                        <div class="pt-3 flex justify-center">
                            <button 
                                type="submit" 
                                id="resetVerifyOtpBtn"
                                class="w-64 bg-primary hover:bg-primaryDark active:bg-primaryDark text-white font-semibold py-2.5 px-8 rounded-xl transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg hover:shadow-[#18CB96]/30 active:translate-y-0 focus:outline-none focus:ring-4 focus:ring-[#18CB96]/50 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                                aria-label="Verify reset OTP"
                            >
                                Verify OTP
                            </button>
                        </div>
                    </form>
                </div>
            </div><!-- end right column -->
        </div><!-- end card -->
    </div><!-- end page wrapper -->

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const emailFromUrl = urlParams.get('email');
            const email = emailFromUrl || localStorage.getItem('resetEmail') || '';
            const emailText = document.getElementById('resetOtpEmailText');
            const otpInputs = document.querySelectorAll('#resetOtpContainer input');
            const otpHidden = document.getElementById('resetOtpValue');
            const form = document.getElementById('resetOtpForm');
            const btn = document.getElementById('resetVerifyOtpBtn');
            const msgEl = document.getElementById('resetOtpMessage');

            if (email && emailText) {
                emailText.textContent = email;
            }

            // OTP input behavior
            otpInputs.forEach((input, index) => {
                input.addEventListener('input', function () {
                    this.value = this.value.replace(/[^0-9]/g, '');
                    if (this.value && index < otpInputs.length - 1) {
                        otpInputs[index + 1].focus();
                    }
                    updateOtpValue();
                });

                input.addEventListener('keydown', function (e) {
                    if (e.key === 'Backspace' && !this.value && index > 0) {
                        otpInputs[index - 1].focus();
                    }
                });
            });

            function updateOtpValue() {
                const otp = Array.from(otpInputs).map(i => i.value).join('');
                otpHidden.value = otp;
            }

            if (form) {
                form.addEventListener('submit', function (e) {
                    e.preventDefault();
                    const otp = otpHidden.value.trim();

                    if (otp.length !== 6) {
                        showMessage('Please enter a valid 6-digit OTP.', 'error');
                        return;
                    }

                    btn.disabled = true;
                    btn.textContent = 'Verifying...';

                    // TODO: Replace with real verify-otp API: POST /reset-password/verify-otp
                    setTimeout(function () {
                        showMessage('OTP verified successfully. Redirecting...', 'success');

                        setTimeout(function () {
                            window.location.href = 'reset-password-new-password.html';
                        }, 800);
                    }, 600);
                });
            }

            function showMessage(text, type) {
                if (!msgEl) return;
                msgEl.textContent = text;
                msgEl.className = 'text-center text-sm py-2 rounded-lg ' + (type === 'error'
                    ? 'bg-red-50 text-red-600 border border-red-200'
                    : 'bg-green-50 text-green-600 border border-green-200');
                msgEl.classList.remove('hidden');

                setTimeout(function () {
                    msgEl.classList.add('hidden');
                }, 5000);
            }

            // Focus first OTP box
            if (otpInputs.length > 0) {
                otpInputs[0].focus();
            }
        });
    </script>
</body>
</html>
