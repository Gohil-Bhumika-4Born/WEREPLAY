{% extends "base/main_base.html" %}

{% set current_page = 'chat_reports' %}

{% block title %}WeReplay Admin Panel - Chat Report Details{% endblock %}

{% block page_title %}Chat Report Details{% endblock %}

{% block page_icon %}
<svg class="w-6 h-6 text-primaryDark dark:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
</svg>
{% endblock %}

{% block main_content %}
<!-- Content -->
            <div class="p-4 sm:p-6 lg:p-8 space-y-6 sm:space-y-8">
                <!-- Breadcrumb & Back -->
                

                <!-- Topic Header Section -->
                <section class="relative overflow-hidden rounded-2xl sm:rounded-3xl bg-white/90 dark:bg-[#252525] border border-primary/15 dark:border-primary/20 shadow-lg shadow-primary/5 dark:shadow-black/30 px-4 sm:px-6 lg:px-8 py-4 sm:py-5 lg:py-6">
                    <div class="absolute inset-0 bg-gradient-to-r from-primary/10 via-transparent to-primaryDark/10 opacity-80 pointer-events-none"></div>
                    <div class="relative z-10 flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4 lg:gap-6">
                        <div class="flex-1 space-y-3">
                            <div>
                                <p class="text-[11px] sm:text-xs font-semibold tracking-[0.22em] uppercase text-primaryDark/80 dark:text-white mb-1">Chat Topic Details</p>
                                <h2 id="topicTitle" class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900 dark:text-white leading-tight">{{ report.title }}</h2>
                            </div>
                            <p id="topicDescription" class="text-sm sm:text-base text-gray-600 dark:text-gray-300 max-w-2xl">{{ report.description }}</p>
                            <div class="flex flex-wrap gap-2">
                                <span id="topicSentiment" class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold 
                                    {% if report.sentiment|upper == 'POSITIVE' %}bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400
                                    {% elif report.sentiment|upper == 'FRUSTRATED' %}bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400
                                    {% else %}bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400{% endif %}">
                                    {{ report.sentiment }}
                                </span>
                                <span id="topicCategory" class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200">{{ report.category }}</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 min-w-[280px] sm:min-w-[320px]">
                            <div class="rounded-2xl bg-gradient-to-br from-white via-[#F6FFFB] to-[#ECFFF9] dark:from-[#1E1E1E] dark:via-[#1E1E1E] dark:to-[#1E1E1E] border border-primary/20 dark:border-primary/30 px-3 py-3 sm:px-4 sm:py-3.5 flex flex-col justify-center shadow-sm hover:shadow-md transition-all">
                                <p class="text-[11px] sm:text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-1">Total Messages</p>
                                <p id="topicTotalMessages" class="text-lg sm:text-xl font-extrabold text-primaryDark dark:text-white leading-snug">{{ report.message_count }}</p>
                            </div>
                            <div class="rounded-2xl bg-gradient-to-br from-white via-[#F6FFFB] to-[#ECFFF9] dark:from-[#1E1E1E] dark:via-[#1E1E1E] dark:to-[#1E1E1E] border border-primary/20 dark:border-primary/30 px-3 py-3 sm:px-4 sm:py-3.5 flex flex-col justify-center shadow-sm hover:shadow-md transition-all">
                                <p class="text-[11px] sm:text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-1">First Seen</p>
                                <p id="topicFirstSeen" class="text-sm sm:text-base font-semibold text-gray-900 dark:text-white leading-snug">{{ report.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                            </div>
                            <div class="rounded-2xl bg-gradient-to-br from-white via-[#F6FFFB] to-[#ECFFF9] dark:from-[#1E1E1E] dark:via-[#1E1E1E] dark:to-[#1E1E1E] border border-primary/20 dark:border-primary/30 px-3 py-3 sm:px-4 sm:py-3.5 flex flex-col justify-center shadow-sm hover:shadow-md transition-all">
                                <p class="text-[11px] sm:text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-1">Last Updated</p>
                                <p id="topicLastUpdated" class="text-sm sm:text-base font-semibold text-gray-900 dark:text-white leading-snug">{{ report.last_check_time.strftime('%Y-%m-%d %H:%M') if report.last_check_time else report.updated_at.strftime('%Y-%m-%d %H:%M') }}</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Messages & Suggested Improvements Layout -->
                <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
                    <!-- Messages List -->
                    <section class="xl:col-span-2 relative overflow-hidden bg-white/95 dark:bg-[#252525] rounded-2xl sm:rounded-3xl shadow-lg shadow-primary/10 dark:shadow-black/40 border border-primary/15 dark:border-primary/25 p-4 sm:p-6 flex flex-col">
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(24,203,150,0.12),_transparent_55%)] pointer-events-none opacity-90"></div>
                        <div class="relative z-10 flex flex-col h-full">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4">
                                <div>
                                    <h3 class="text-lg sm:text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
                                        <span class="inline-flex items-center justify-center w-7 h-7 rounded-full bg-primary/10 dark:text-white text-primaryDark">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                            </svg>
                                        </span>
                                        Conversation Messages
                                    </h3>
                                    <p class="mt-1 text-xs sm:text-sm text-gray-600 dark:text-gray-300">Scrollable conversation with filters for User and AI messages.</p>
                                </div>
                                <div class="inline-flex items-center bg-gray-100 dark:bg-[#1E1E1E] rounded-full p-1 text-xs sm:text-sm border border-gray-200 dark:border-gray-700">
                                    <button id="filterAll" class="px-3 py-1.5 rounded-full font-medium text-gray-800 dark:text-gray-100 bg-white dark:bg-[#333333] shadow-sm transition-all duration-200">All</button>
                                    <button id="filterUser" class="px-3 py-1.5 rounded-full font-medium text-gray-500 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100 transition-all duration-200">User</button>
                                    <button id="filterAI" class="px-3 py-1.5 rounded-full font-medium text-gray-500 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100 transition-all duration-200">AI</button>
                                </div>
                            </div>

                            <div id="messagesContainer" class="relative flex-1 min-h-[300px] max-h-[500px] overflow-y-auto space-y-4 pr-2 custom-scrollbar">
                                <!-- Messages will be rendered here -->
                            </div>
                        </div>
                    </section>

                    <!-- Suggested Improvements -->
                    <section class="relative overflow-hidden bg-white/95 dark:bg-[#252525] rounded-2xl sm:rounded-3xl shadow-lg shadow-primary/10 dark:shadow-black/40 border border-primary/15 dark:border-primary/25 p-4 sm:p-6 flex flex-col justify-between">
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(24,203,150,0.12),_transparent_55%)] pointer-events-none opacity-90"></div>
                        <div class="relative z-10 flex flex-col h-full">
                            <div>
                                <div class="flex items-center justify-between mb-3">
                                    <h3 class="text-lg sm:text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
                                        <span class="inline-flex items-center justify-center w-7 h-7 rounded-full bg-primary/10 dark:text-white text-primaryDark">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                            </svg>
                                        </span>
                                        AI Suggestions
                                    </h3>
                                    <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border border-blue-200 dark:border-blue-800">AI Generated</span>
                                </div>
                                <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mb-4">Based on the conversation analysis, here are some suggestions to improve AI performance.</p>
                                <ul id="improvementsList" class="space-y-3 text-xs sm:text-sm text-gray-700 dark:text-gray-200">
                                    <li class="flex items-start gap-2">
                                        <span class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-primary/10 text-primaryDark dark:text-white text-xs font-semibold mt-0.5 flex-shrink-0">1</span>
                                        <span>Review and improve AI response accuracy for pricing inquiries</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-primary/10 text-primaryDark dark:text-white text-xs font-semibold mt-0.5 flex-shrink-0">2</span>
                                        <span>Consider adding supporting documents for subscription plans</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-primary/10 text-primaryDark dark:text-white text-xs font-semibold mt-0.5 flex-shrink-0">3</span>
                                        <span>Update FAQs for recurring questions about billing</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-primary/10 text-primaryDark dark:text-white text-xs font-semibold mt-0.5 flex-shrink-0">4</span>
                                        <span>Check API responses and integration flows for errors</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-primary/10 text-primaryDark dark:text-white text-xs font-semibold mt-0.5 flex-shrink-0">5</span>
                                        <span>Retrain the AI on latest support cases for this topic</span>
                                    </li>
                                </ul>
                            </div>
                            <div class="mt-6 pt-4 ">
                                <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">
                                    <span class="font-semibold text-gray-800 dark:text-gray-100">Note:</span> These suggestions are generated by AI analysis and can be enhanced with real insights from your backend.
                                </p>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Footer Actions -->
                <section class="relative overflow-hidden bg-white/95 dark:bg-[#252525] rounded-2xl sm:rounded-3xl shadow-lg shadow-primary/10 dark:shadow-black/40 border border-primary/15 dark:border-primary/25 p-4 sm:p-6">
                    <div class="absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(24,203,150,0.12),_transparent_55%)] pointer-events-none opacity-90"></div>
                    <div class="relative z-10 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                        <div class="space-y-1">
                            <p class="text-xs sm:text-sm text-gray-700 dark:text-gray-300">
                                <span class="font-semibold text-gray-900 dark:text-white">Need to improve this topic?</span> Retrain the AI or download the full conversation for analysis.
                            </p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">WeReplyx - Automate Your WhatsApp Customer Support</p>
                        </div>
                        <div class="flex flex-wrap gap-2 sm:gap-3">
                            <button onclick="retrainAI()" class="inline-flex items-center gap-2 px-4 py-2.5 rounded-xl bg-[#18CB96] hover:bg-primaryDark dark:bg-[#18CB96] dark:hover:bg-primaryDark text-white text-sm font-semibold shadow-md hover:shadow-lg hover:shadow-[#18CB96]/30 transition-all duration-300 ease-out hover:scale-[1.02] hover:-translate-y-0.5">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9H4m0 0V4m0 5a8.003 8.003 0 0014.197 5.294M20 20v-5h-.581"></path>
                                </svg>
                                Retrain AI
                            </button>
                            <button onclick="downloadTopicChat()" class="inline-flex items-center gap-2 px-4 py-2.5 rounded-xl bg-primaryDark dark:bg-[#333333] hover:bg-gray-100 dark:hover:bg-[#3A3A3A] text-white dark:text-gray-100 text-sm font-semibold border border-gray-200 dark:border-gray-700 transition-all duration-300 ease-out hover:scale-[1.02] hover:-translate-y-0.5 shadow-sm hover:shadow-md">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5 5m0 0l5-5m-5 5V4"></path>
                                </svg>
                                Download Chat
                            </button>
                           
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>
{% endblock %}
