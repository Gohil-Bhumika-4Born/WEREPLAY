{% extends "base/main_base.html" %}

{% set current_page = 'notifications' %}

{% block title %}WeReplay Admin Panel - Notifications{% endblock %}

{% block page_title %}Notifications{% endblock %}

{% block page_icon %}
<svg class="w-6 h-6 text-primaryDark dark:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
</svg>
{% endblock %}

{% block main_content %}
<div class="space-y-6 sm:space-y-8 animate-fade-in">
    <!-- Page Title + Description -->
    <section class="relative overflow-hidden rounded-2xl sm:rounded-3xl bg-white/90 dark:bg-[#252525] border border-primary/15 dark:border-primary/20 shadow-lg shadow-primary/5 dark:shadow-black/30 px-4 sm:px-6 lg:px-8 py-4 sm:py-5 lg:py-6">
        <div class="absolute inset-0 bg-gradient-to-r from-primary/10 via-transparent to-primaryDark/10 opacity-80 pointer-events-none"></div>
        <div class="relative z-10 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
            <div>
                <p class="text-[11px] sm:text-xs font-semibold tracking-[0.22em] uppercase text-primaryDark/80 mb-1 dark:text-white">
                    System Â· Alerts & Updates
                </p>
                <h2 class="text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 dark:text-white leading-tight">
                    Notifications Center
                </h2>
                <p class="mt-1 text-xs sm:text-sm text-gray-600 dark:text-gray-300 max-w-xl">
                    Stay updated with system alerts, training status, billing updates, and important messages.
                </p>
            </div>
            <!-- Quick Stats Pills -->
            <div class="grid grid-cols-2 sm:grid-cols-2 gap-2 sm:gap-3 min-w-[220px] sm:min-w-[260px]">
                <div class="rounded-2xl bg-light/80 dark:bg-[#1E1E1E] border border-primary/20 px-3 py-2.5 sm:px-4 sm:py-3 flex flex-col justify-center">
                    <span class="text-[11px] sm:text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide">
                        Total
                    </span>
                    <span id="totalNotificationsCount" class="text-lg sm:text-xl font-extrabold text-primaryDark dark:text-white leading-snug">
                        0
                    </span>
                </div>
                <div class="rounded-2xl bg-red-50/90 dark:bg-red-900/20 border border-red-200/80 dark:border-red-700/60 px-3 py-2.5 sm:px-4 sm:py-3 flex flex-col justify-center">
                    <span class="text-[11px] sm:text-xs font-semibold text-red-700/90 dark:text-red-300 uppercase tracking-wide">
                        Unread
                    </span>
                    <span id="unreadNotificationsCount" class="text-lg sm:text-xl font-extrabold text-red-600 dark:text-red-300 leading-snug">
                        0
                    </span>
                </div>
            </div>
        </div>
    </section>

    <!-- Notifications Table Section -->
    <section class="bg-white/95 dark:bg-[#252525] rounded-2xl sm:rounded-3xl shadow-lg shadow-primary/10 dark:shadow-black/40 overflow-hidden">
        <!-- Search & Actions Bar -->
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3 p-4 sm:p-6">
            <h3 class="text-lg font-bold text-gray-900 dark:text-white">Notifications</h3>
            <div class="flex flex-row gap-3 items-center">
                <div class="relative lg:min-w-[300px]">
                    <span class="absolute inset-y-0 left-3 flex items-center pointer-events-none">
                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M11 19a8 8 0 100-16 8 8 0 000 16z"/>
                        </svg>
                    </span>
                    <input type="text" id="searchInput" onkeyup="applyFilters()" placeholder="Search notifications..." class="w-full pl-9 pr-3 py-2.5 bg-white/90 dark:bg-[#1E1E1E] border border-gray-200 dark:border-gray-700 rounded-xl text-gray-900 dark:text-white text-sm placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:ring-2 focus:ring-[#18CB96]">
                </div>
                <button onclick="openFilterModal()" class="inline-flex items-center justify-center px-3 py-2.5 bg-[#18CB96] hover:bg-primaryDark dark:bg-[#18CB96] dark:hover:bg-primaryDark text-white rounded-xl font-semibold transition-all duration-300 ease-out hover:scale-[1.02] text-sm shadow-md shadow-primary/30 hover:shadow-lg hover:shadow-[#18CB96]/30 flex-shrink-0" aria-label="Open filters">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                    </svg>
                </button>
            </div>
        </div>

        <div class="overflow-x-auto rounded-xl overflow-hidden">
            <table class="w-full border-collapse">
                <thead>
                    <tr class="bg-primaryDark dark:from-[#1E1E1E] dark:to-[#2A2A2A]">
                        <th class="text-left py-4 px-4 sm:px-6 text-xs sm:text-sm font-bold text-white uppercase tracking-wider w-16 sm:w-auto">Type</th>
                        <th class="text-left py-4 px-4 sm:px-6 text-xs sm:text-sm font-bold text-white uppercase tracking-wider min-w-[200px] sm:min-w-0">Title & Message</th>
                        <th class="text-left py-4 px-4 sm:px-6 text-xs sm:text-sm font-bold text-white uppercase tracking-wider">Category</th>
                        <th class="text-left py-4 px-4 sm:px-6 text-xs sm:text-sm font-bold text-white uppercase tracking-wider">Status</th>
                        <th class="text-left py-4 px-4 sm:px-6 text-xs sm:text-sm font-bold text-white uppercase tracking-wider w-32 sm:w-auto">Date</th>
                        <th class="text-left py-4 px-4 sm:px-6 text-xs sm:text-sm font-bold text-white uppercase tracking-wider w-16 sm:w-auto">Actions</th>
                    </tr>
                </thead>
                <tbody id="notificationsList">
                    <!-- Table rows will be populated by JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="hidden p-12 text-center animate-fade-in">
            <svg class="w-16 h-16 mx-auto text-gray-400 dark:text-gray-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
            </svg>
            <p class="text-lg font-medium text-gray-900 dark:text-white mb-2">No notifications found</p>
            <p class="text-sm text-gray-600 dark:text-gray-400">Try adjusting your filters or search criteria</p>
        </div>
    </section>

    <!-- Pagination -->
    <section class="flex flex-col sm:flex-row items-center justify-between gap-4 bg-white/95 dark:bg-[#252525] rounded-2xl sm:rounded-3xl shadow-lg shadow-primary/5 dark:shadow-black/30 p-4 sm:p-6">
        <div class="text-sm text-gray-600 dark:text-gray-400">
            Showing <span id="showFrom" class="font-medium text-gray-900 dark:text-white">0</span> to <span id="showTo" class="font-medium text-gray-900 dark:text-white">0</span> of <span id="showTotal" class="font-medium text-gray-900 dark:text-white">0</span> results
        </div>
        <div class="flex items-center gap-2">
            <div id="paginationControls" class="flex items-center gap-2"></div>
            <select id="pageSize" class="ml-4 px-3 py-2 bg-white dark:bg-[#1E1E1E] border border-gray-200 dark:border-gray-700 rounded-lg text-gray-900 dark:text-white text-sm focus:ring-2 focus:ring-[#18CB96]">
                <option value="10">10 per page</option>
                <option value="20">20 per page</option>
                <option value="50">50 per page</option>
                <option value="100">100 per page</option>
            </select>
        </div>
    </section>
</div>

<!-- Filter Modal -->
<div id="filterModal" class="hidden fixed inset-0 z-50 overflow-y-auto" aria-labelledby="filter-modal-title" role="dialog" aria-modal="true">
    <!-- Backdrop -->
    <div class="fixed inset-0 bg-black/50 backdrop-blur-sm pointer-events-none" aria-hidden="true" onclick="closeFilterModal()"></div>

    <div class="flex min-h-full items-center justify-center p-4">
        <div id="filterModalContent" class="relative bg-gradient-to-b from-white via-[#F6FFFB] to-[#ECFFF9] dark:from-[#1E1E1E] dark:via-[#1E1E1E] dark:to-[#1E1E1E] rounded-2xl shadow-2xl max-w-lg w-full p-6 transform transition-all duration-300 ease-out scale-95 opacity-0 border border-primary/20">
            <!-- Close Button -->
            <button onclick="closeFilterModal()" class="absolute top-4 right-4 p-2 rounded-lg text-gray-400 dark:text-white hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-[#333333] transition-colors" aria-label="Close modal">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>

            <!-- Modal Header -->
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 rounded-xl bg-[#18CB96]/10 dark:bg-[#18CB96]/20 flex items-center justify-center">
                    <svg class="w-5 h-5 text-[#18CB96]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                    </svg>
                </div>
                <h3 id="filter-modal-title" class="text-xl font-bold text-gray-900 dark:text-white">Smart Filters</h3>
            </div>

            <!-- Filter Categories -->
            <div class="space-y-6">
                <div class="grid grid-cols-2 gap-4">
                    <!-- Type Filter -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Type</label>
                        <select id="filter-type" class="w-full px-3 py-2.5 bg-gray-50 dark:bg-[#252525] border border-gray-200 dark:border-gray-700 rounded-lg text-sm text-gray-900 dark:text-white focus:ring-2 focus:ring-[#18CB96] focus:outline-none">
                            <option value="">All Types</option>
                            <option value="success">Success</option>
                            <option value="info">Info</option>
                            <option value="warning">Warning</option>
                            <option value="error">Error</option>
                        </select>
                    </div>

                    <!-- Category Filter -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Category</label>
                        <select id="filter-category" class="w-full px-3 py-2.5 bg-gray-50 dark:bg-[#252525] border border-gray-200 dark:border-gray-700 rounded-lg text-sm text-gray-900 dark:text-white focus:ring-2 focus:ring-[#18CB96] focus:outline-none">
                            <option value="">All Categories</option>
                            <option value="training">Training</option>
                            <option value="document">Document</option>
                            <option value="whatsapp">WhatsApp</option>
                            <option value="billing">Billing</option>
                            <option value="plan">Plan</option>
                            <option value="system">System</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <!-- Status Filter -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Status</label>
                        <select id="filter-status" class="w-full px-3 py-2.5 bg-gray-50 dark:bg-[#252525] border border-gray-200 dark:border-gray-700 rounded-lg text-sm text-gray-900 dark:text-white focus:ring-2 focus:ring-[#18CB96] focus:outline-none">
                            <option value="">All Status</option>
                            <option value="unread">Unread</option>
                            <option value="read">Read</option>
                        </select>
                    </div>

                    <!-- Date Range Filter -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Date Range</label>
                        <select id="filter-date-range" class="w-full px-3 py-2.5 bg-gray-50 dark:bg-[#252525] border border-gray-200 dark:border-gray-700 rounded-lg text-sm text-gray-900 dark:text-white focus:ring-2 focus:ring-[#18CB96] focus:outline-none">
                            <option value="all">All time</option>
                            <option value="24h">Last 24 hours</option>
                            <option value="7d">Last 7 days</option>
                            <option value="30d">Last 30 days</option>
                        </select>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-3 pt-2">
                    <button onclick="applyFilters()" class="flex-1 bg-[#18CB96] hover:bg-primaryDark text-white font-bold py-3 rounded-xl transition-all shadow-md shadow-[#18CB96]/20">
                        Apply Filters
                    </button>
                    <button onclick="resetFilters()" class="flex-1 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 font-bold py-3 rounded-xl border border-gray-200 dark:border-gray-700 hover:bg-gray-200 dark:hover:bg-gray-700 transition-all">
                        Reset
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Notification Detail Drawer -->
<div id="notificationDrawer" class="hidden fixed inset-0 z-50 overflow-hidden" aria-modal="true" role="dialog">
    <!-- Backdrop -->
    <div class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity duration-300" onclick="closeNotificationDrawer()"></div>

    <!-- Drawer Panel -->
    <div id="notificationDrawerPanel" class="fixed right-1 top-1 bottom-1 sm:right-4 sm:top-4 sm:bottom-4 w-full max-w-sm sm:max-w-lg bg-gradient-to-b from-white via-[#F6FFFB] to-[#ECFFF9] dark:from-[#1E1E1E] dark:via-[#1E1E1E] dark:to-[#1E1E1E] shadow-2xl transform transition-transform duration-300 ease-out translate-x-full rounded-xl sm:rounded-3xl overflow-hidden">
        <!-- Drawer Header -->
        <div class="flex items-center justify-between p-3 sm:p-6 bg-white/50 dark:bg-[#252525]/50 backdrop-blur-sm">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-[#18CB96]/10 dark:bg-[#18CB96]/20 flex items-center justify-center">
                    <svg class="w-5 h-5 text-[#18CB96]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                    </svg>
                </div>
                <div>
                    <h2 class="text-base sm:text-lg font-bold text-gray-900 dark:text-white">Notification Details</h2>
                    <p class="text-[11px] sm:text-xs text-gray-500 dark:text-gray-400">View complete notification information</p>
                </div>
            </div>
            <button onclick="closeNotificationDrawer()" class="p-2 rounded-lg text-gray-400 dark:text-white hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-[#333333] transition-all duration-200 hover:scale-105" aria-label="Close drawer">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <!-- Drawer Content -->
        <div class="flex-1 overflow-y-auto">
            <div id="notificationDrawerContent" class="p-3 sm:p-6 space-y-3 sm:space-y-6">
                <!-- Content populated by JS -->
            </div>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div id="toastContainer" class="fixed top-4 right-4 z-[60] space-y-3 max-w-xs sm:max-w-sm"></div>
{% endblock %}

{% block extra_scripts %}
<script>
    const notifications = [
        {
            id: '1',
            title: 'Training Completed',
            message: 'Model v3 has finished training successfully with 94% accuracy.',
            type: 'success',
            category: 'training',
            isRead: false,
            createdAt: new Date().toISOString(),
            actionUrl: "{{ url_for('main.ai_training') }}"
        },
        {
            id: '2',
            title: 'Document Processing Failed',
            message: 'File invoice_Q4.pdf could not be processed due to unreadable pages.',
            type: 'error',
            category: 'document',
            isRead: false,
            createdAt: new Date(Date.now() - 3600000).toISOString(),
            actionUrl: "{{ url_for('main.documents') }}"
        },
        {
            id: '3',
            title: 'WhatsApp Disconnected',
            message: 'Your WhatsApp Business account lost connection. Please reconnect to continue automation.',
            type: 'error',
            category: 'whatsapp',
            isRead: true,
            createdAt: new Date(Date.now() - 86400000).toISOString(),
            actionUrl: '#'
        },
        {
            id: '4',
            title: 'Plan Usage at 80%',
            message: 'You have used 80% of your current plan message limit.',
            type: 'warning',
            category: 'plan',
            isRead: false,
            createdAt: new Date(Date.now() - 172800000).toISOString(),
            actionUrl: "{{ url_for('main.plans_billing') }}"
        },
        {
            id: '5',
            title: 'Report Ready',
            message: 'Your weekly chat report is ready to view.',
            type: 'info',
            category: 'system',
            isRead: true,
            createdAt: new Date(Date.now() - 259200000).toISOString(),
            actionUrl: "#"
        }
    ];

    let filtered = [...notifications];
    let currentPage = 1;
    let pageSize = 10;

    function renderNotifications() {
        const list = document.getElementById('notificationsList');
        const emptyState = document.getElementById('emptyState');
        if (!list) return;

        if (filtered.length === 0) {
            list.innerHTML = '';
            emptyState.classList.remove('hidden');
            updatePagination(0, 0, 0);
            return;
        }

        emptyState.classList.add('hidden');
        const start = (currentPage - 1) * pageSize;
        const end = start + pageSize;
        const pageItems = filtered.slice(start, end);

        list.innerHTML = pageItems.map((n, index) => {
            const iconColors = {
                success: 'text-green-500',
                info: 'text-blue-500',
                warning: 'text-orange-500',
                error: 'text-red-500'
            };
            const iconSvgs = {
                success: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />',
                info: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />',
                warning: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />',
                error: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />'
            };

            const iconColor = iconColors[n.type] || iconColors.info;
            const iconSvg = iconSvgs[n.type] || iconSvgs.info;
            
            const rowBgClass = index % 2 === 0 
                ? 'bg-white dark:bg-[#252525]' 
                : 'bg-gray-50/50 dark:bg-[#1E1E1E]/50';
            
            return `
                <tr class="${rowBgClass} hover:bg-gray-100/50 dark:hover:bg-[#333333] transition-all duration-300 ease-out cursor-pointer" onclick="openNotificationDrawer('${n.id}')">
                    <td class="py-4 px-4 sm:px-6">
                        <svg class="w-6 h-6 ${iconColor} flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            ${iconSvg}
                        </svg>
                    </td>
                    <td class="py-4 px-4 sm:px-6 min-w-[200px]">
                        <div>
                            <p class="font-bold text-gray-900 dark:text-white text-sm sm:text-base leading-tight">${n.title}</p>
                            <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1">${n.message}</p>
                        </div>
                    </td>
                    <td class="py-4 px-4 sm:px-6">
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300 lowercase">${n.category}</span>
                    </td>
                    <td class="py-4 px-4 sm:px-6">
                        ${!n.isRead 
                            ? '<span class="px-3 py-1 bg-blue-100/80 dark:bg-blue-900/40 text-blue-600 dark:text-blue-300 rounded-full text-xs font-semibold">Unread</span>'
                            : '<span class="text-xs font-semibold text-gray-700 dark:text-gray-300">Read</span>'
                        }
                    </td>
                    <td class="py-4 px-4 sm:px-6 whitespace-nowrap">
                        <span class="text-xs text-gray-500 dark:text-gray-400 font-medium">${timeAgo(n.createdAt)}</span>
                    </td>
                    <td class="py-4 px-4 sm:px-6">
                        <button class="text-[11px] sm:text-xs text-[#18CB96] hover:text-primaryDark font-bold transition-all text-center">View<br>Details</button>
                    </td>
                </tr>
            `;
        }).join('');

        updatePagination(start + 1, Math.min(end, filtered.length), filtered.length);
    }

    function timeAgo(iso) {
        const diff = (Date.now() - new Date(iso).getTime()) / 1000;
        if (diff < 60) return 'Just now';
        if (diff < 3600) return Math.floor(diff / 60) + 'm ago';
        if (diff < 86400) return Math.floor(diff / 3600) + 'h ago';
        return Math.floor(diff / 86400) + 'd ago';
    }

    function updatePagination(from, to, total) {
        document.getElementById('showFrom').textContent = total ? from : 0;
        document.getElementById('showTo').textContent = total ? to : 0;
        document.getElementById('showTotal').textContent = total;

        const container = document.getElementById('paginationControls');
        container.innerHTML = '';
        const totalPages = Math.ceil(total / pageSize) || 1;

        for (let i = 1; i <= totalPages; i++) {
            const btn = document.createElement('button');
            btn.textContent = i;
            btn.className = `w-10 h-10 rounded-xl flex items-center justify-center font-bold text-sm transition-all ${
                i === currentPage 
                ? 'bg-[#18CB96] text-white shadow-lg' 
                : 'bg-gray-100 dark:bg-[#333333] text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-[#444444]'
            }`;
            btn.onclick = () => { currentPage = i; renderNotifications(); };
            container.appendChild(btn);
        }
    }

    function updateNotificationStats() {
        const total = notifications.length;
        const unread = notifications.filter(n => !n.isRead).length;
        document.getElementById('totalNotificationsCount').textContent = total;
        document.getElementById('unreadNotificationsCount').textContent = unread;
    }

    function openFilterModal() {
        const modal = document.getElementById('filterModal');
        const content = document.getElementById('filterModalContent');
        modal.classList.remove('hidden');
        setTimeout(() => {
            content.classList.remove('scale-95', 'opacity-0');
            content.classList.add('scale-100', 'opacity-100');
        }, 10);
        document.body.style.overflow = 'hidden';
    }

    function closeFilterModal() {
        const modal = document.getElementById('filterModal');
        const content = document.getElementById('filterModalContent');
        content.classList.remove('scale-100', 'opacity-100');
        content.classList.add('scale-95', 'opacity-0');
        setTimeout(() => {
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }, 300);
    }

    function applyFilters() {
        const search = document.getElementById('searchInput').value.toLowerCase();
        const type = document.getElementById('filter-type')?.value || '';
        const cat = document.getElementById('filter-category')?.value || '';
        const status = document.getElementById('filter-status')?.value || '';

        filtered = notifications.filter(n => {
            if (search && !n.title.toLowerCase().includes(search) && !n.message.toLowerCase().includes(search)) return false;
            if (type && n.type !== type) return false;
            if (cat && n.category !== cat) return false;
            if (status === 'unread' && n.isRead) return false;
            if (status === 'read' && !n.isRead) return false;
            return true;
        });

        currentPage = 1;
        renderNotifications();
        if (typeof closeFilterModal === 'function' && !document.getElementById('filterModal').classList.contains('hidden')) {
            closeFilterModal();
        }
    }

    function resetFilters() {
        document.getElementById('searchInput').value = '';
        if (document.getElementById('filter-type')) document.getElementById('filter-type').value = '';
        if (document.getElementById('filter-category')) document.getElementById('filter-category').value = '';
        if (document.getElementById('filter-status')) document.getElementById('filter-status').value = '';
        filtered = [...notifications];
        currentPage = 1;
        renderNotifications();
    }

    function openNotificationDrawer(id) {
        const n = notifications.find(x => x.id === id);
        if (!n) return;
        n.isRead = true;
        updateNotificationStats();
        renderNotifications();

        const typeStyles = {
            success: 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 border-green-200 dark:border-green-700',
            info: 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border-blue-200 dark:border-blue-700',
            warning: 'bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 border-orange-200 dark:border-orange-700',
            error: 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 border-red-200 dark:border-red-700'
        };
        const iconSvgs = {
            success: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />',
            info: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />',
            warning: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />',
            error: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />'
        };

        const container = document.getElementById('notificationDrawerContent');
        container.innerHTML = `
            <!-- Notification Type & Status Section -->
            <div class="bg-gradient-to-r from-gray-50/80 to-white/80 dark:from-[#252525]/80 dark:to-[#1E1E1E]/80 rounded-xl sm:rounded-2xl p-3 sm:p-5 border border-[#18CB96]/20 dark:border-[#18CB96]/30">
                <div class="flex items-start gap-4">
                    <div class="h-14 w-14 rounded-2xl ${typeStyles[n.type].split(' ')[0]} flex items-center justify-center flex-shrink-0 shadow-sm">
                        <svg class="w-7 h-7 ${typeStyles[n.type].split(' ')[0]}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            ${iconSvgs[n.type]}
                        </svg>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2 flex-wrap mb-3">
                            <span class="px-3 py-1.5 rounded-xl text-xs font-bold ${typeStyles[n.type]} border shadow-sm">
                                ${n.type.toUpperCase()}
                            </span>
                            <span class="px-3 py-1.5 rounded-xl text-xs font-semibold bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-600 shadow-sm">
                                ${n.category.charAt(0).toUpperCase() + n.category.slice(1)}
                            </span>
                            ${!n.isRead ? '<span class="px-3 py-1.5 rounded-xl text-xs font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border border-blue-200 dark:border-blue-700 shadow-sm">Unread</span>' : '<span class="px-3 py-1.5 rounded-xl text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-600 shadow-sm">Read</span>'}
                        </div>
                        <div class="flex items-center gap-2 text-xs sm:text-sm text-gray-500 dark:text-gray-400">
                            <svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span class="font-medium">${new Date(n.createdAt).toLocaleString()}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notification Title & Message -->
            <div class="space-y-4">
                <div>
                    <h1 class="text-base sm:text-lg font-bold text-gray-900 dark:text-white leading-tight mb-2 sm:mb-3">${n.title}</h1>
                    <div class="bg-white/60 dark:bg-[#252525]/60 rounded-xl sm:rounded-2xl p-3 sm:p-4 border border-[#18CB96]/15 dark:border-[#18CB96]/25 shadow-sm">
                        <p class="text-xs sm:text-sm text-gray-700 dark:text-white leading-relaxed">${n.message}</p>
                    </div>
                </div>

                <!-- Action Button -->
                ${n.actionUrl ? `
                    <div class="pt-2">
                        <a href="${n.actionUrl}" class="inline-flex items-center gap-2 px-4 py-2.5 bg-primary hover:bg-primaryDark text-white rounded-xl font-semibold transition-all duration-300 shadow-md shadow-[#18CB96]/25 hover:shadow-lg hover:shadow-[#18CB96]/35 transform hover:-translate-y-0.5 w-full justify-center group text-sm">
                            <span class="text-sm sm:text-base">Open Related Page</span>
                            <svg class="w-5 h-5 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </a>
                    </div>
                ` : ''}

                <!-- Additional Information Section -->
                <div class="bg-gradient-to-r from-[#18CB96]/5 to-[#14a87a]/5 dark:from-[#18CB96]/10 dark:to-[#14a87a]/10 rounded-xl sm:rounded-2xl p-3 sm:p-4 border border-[#18CB96]/20 dark:border-[#18CB96]/30">
                    <div class="flex items-start gap-3">
                        <div class="w-8 h-8 rounded-lg bg-[#18CB96]/10 dark:bg-[#18CB96]/20 flex items-center justify-center flex-shrink-0">
                            <svg class="w-4 h-4 text-[#18CB96] dark:text-[#18CB96]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                    <div>
                        <h4 class="text-[11px] sm:text-xs font-semibold text-[#18CB96] dark:text-[#18CB96] mb-1">Need Help?</h4>
                        <p class="text-[11px] sm:text-xs text-gray-600 dark:text-gray-300 leading-relaxed">
                            If you have questions about this notification or need assistance, please contact our support team.
                        </p>
                    </div>
                    </div>
                </div>
            </div>
        `;

        const drawer = document.getElementById('notificationDrawer');
        const panel = document.getElementById('notificationDrawerPanel');
        drawer.classList.remove('hidden');
        setTimeout(() => {
            panel.classList.remove('translate-x-full');
            panel.classList.add('translate-x-0');
        }, 10);
        document.body.style.overflow = 'hidden';
    }

    function closeNotificationDrawer() {
        const panel = document.getElementById('notificationDrawerPanel');
        panel.classList.remove('translate-x-0');
        panel.classList.add('translate-x-full');
        setTimeout(() => {
            document.getElementById('notificationDrawer').classList.add('hidden');
            document.body.style.overflow = '';
        }, 300);
    }

    document.addEventListener('DOMContentLoaded', () => {
        updateNotificationStats();
        renderNotifications();
        
        document.getElementById('pageSize').addEventListener('change', (e) => {
            pageSize = parseInt(e.target.value);
            currentPage = 1;
            renderNotifications();
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeNotificationDrawer();
                closeFilterModal();
            }
        });
    });
</script>
{% endblock %}
