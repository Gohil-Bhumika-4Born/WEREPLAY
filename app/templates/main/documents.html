{% extends "base/main_base.html" %}

{% set current_page = 'documents' %}

{% block title %}WeReplay Admin Panel - Documents{% endblock %}
{% block page_title %}Documents{% endblock %}

{% block page_icon %}
<svg class="w-6 h-6 text-primaryDark dark:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586
             a1 1 0 01.707.293l5.414 5.414
             a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
</svg>
{% endblock %}

{% block main_content %}

<div class="p-4 sm:p-6 lg:p-8">
    <!-- Quick Actions -->
    <section class="rounded-2xl bg-white dark:bg-[#252525] border p-6 mb-6">
        <div class="flex justify-between items-center">
            <div>
                <p class="text-xs uppercase tracking-widest text-gray-500">Quick Actions</p>
                <p class="text-sm text-gray-600 dark:text-gray-300">
                    Upload and manage documents.
                </p>
            </div>
            <a href="{{ url_for('main.documents_upload') }}"
               class="px-4 py-2 bg-[#18CB96] text-white rounded-lg text-sm font-semibold">
                Upload Document
            </a>
        </div>
    </section>

    <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">

        <!-- ================= LEFT: DOCUMENT LIST ================= -->
        <div class="xl:col-span-2 space-y-4">

            {% if documents %}
            {% for doc in documents %}
            <div class="document-card bg-white dark:bg-[#252525] rounded-xl p-5 border cursor-pointer hover:shadow-lg transition"
                 data-title="{{ doc.document_title }}"
                 data-description="{{ doc.description or 'No description provided.' }}"
                 data-type="{{ doc.file_type }}"
                 data-size="{{ (doc.file_size / 1024)|round(2) }} KB"
                 data-uploaded="{{ doc.created_at.strftime('%d %b, %I:%M %p') }}"
                 data-extracted="{{ (doc.extracted_text or 'Extracted content will appear after processing.')[:1200] | e }}">

                <h3 class="text-lg font-bold text-gray-900 dark:text-white">
                    {{ doc.document_title }}
                </h3>

                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                    {{ doc.description or 'No description provided.' }}
                </p>

                <div class="text-xs text-gray-500 mt-2">
                    Uploaded {{ doc.created_at.strftime('%d %b, %I:%M %p') }}
                </div>

                <div class="flex gap-2 mt-4">
                    <a href="{{ url_for('static', filename=doc.document_path) }}"
                       target="_blank"
                       class="flex-1 text-center py-2 bg-primary/10 rounded text-sm">
                        View
                    </a>
                    <button
                        class="px-3 py-2 bg-red-100 text-red-600 rounded text-sm">
                        Delete
                    </button>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <p class="text-center text-gray-500">No documents uploaded yet.</p>
            {% endif %}

        </div>

        <!-- ================= RIGHT: PREVIEW PANEL ================= -->
        <div class="xl:col-span-1">
            <div class="bg-white dark:bg-[#252525] rounded-xl p-6 border sticky top-24">

                <h3 class="text-lg font-bold mb-4">Document Preview</h3>

                <!-- EMPTY STATE -->
                <div id="previewEmpty"
                     class="text-sm text-gray-500">
                    Select a document to see preview
                </div>

                <!-- PREVIEW CONTENT -->
                <div id="previewContent" class="hidden space-y-4 text-sm">

                    <div>
                        <p class="font-semibold text-gray-900 dark:text-white"
                           id="pvTitle">—</p>
                        <p class="text-gray-600 dark:text-gray-400"
                           id="pvDescription">—</p>
                    </div>

                    <div class="space-y-1">
                        <div class="flex justify-between">
                            <span class="text-gray-500">Type</span>
                            <span id="pvType">—</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Size</span>
                            <span id="pvSize">—</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Uploaded</span>
                            <span id="pvUploaded">—</span>
                        </div>
                    </div>

                    <div class="border-t pt-3">
                        <p class="text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1">
                            Extracted Content
                        </p>
                        <div class="max-h-48 overflow-y-auto text-xs text-gray-600 dark:text-gray-400 whitespace-pre-line"
                             id="pvExtracted">
                            —
                        </div>
                    </div>

                </div>

            </div>
        </div>

    </div>
</div>

<!-- ================= JS ================= -->
<script>
const cards = document.querySelectorAll(".document-card");

const previewEmpty = document.getElementById("previewEmpty");
const previewContent = document.getElementById("previewContent");

const pvTitle = document.getElementById("pvTitle");
const pvDescription = document.getElementById("pvDescription");
const pvType = document.getElementById("pvType");
const pvSize = document.getElementById("pvSize");
const pvUploaded = document.getElementById("pvUploaded");
const pvExtracted = document.getElementById("pvExtracted");

cards.forEach(card => {
    card.addEventListener("click", () => {
        previewEmpty.classList.add("hidden");
        previewContent.classList.remove("hidden");

        pvTitle.textContent = card.dataset.title;
        pvDescription.textContent = card.dataset.description;
        pvType.textContent = card.dataset.type;
        pvSize.textContent = card.dataset.size;
        pvUploaded.textContent = card.dataset.uploaded;
        pvExtracted.textContent = card.dataset.extracted;
    });
});
</script>

{% endblock %}
